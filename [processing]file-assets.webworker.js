(self.webpackChunk_wixc3_stylable_playground_feature=self.webpackChunk_wixc3_stylable_playground_feature||[]).push([[405],{59178:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(5163),s=r(93849),n=i.__importStar(r(2206)),a=i.__importStar(r(32510));t.default=new s.Feature({id:"fileAssets",dependencies:[n.default.asEntity,a.default.asEntity],api:{fileTaggerSlots:s.Slot.withType().defineEntity(n.processingEnv),assets:(0,a.defineComputedResource)().defineEntity(n.processingEnv)}})},51772:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(5163).__importDefault(r(59178)),s=r(60814),n=r(2206),a=r(69144),o=r(24412),c=r(27176);i.default.setup(n.processingEnv,(({fileTaggerSlots:e,assets:t},{project:{fileManager:r,pluggableProjectConfig:i,ignoredSubPathsConfig:l,fs:d,directoryManager:u,projectService:p}})=>{const h=i.get(n.PROJECT_CONFIG_NAME),f=h.isValid()?h.get(l):n.DEFAULT_IGNORED_SUBPATHS;return{assets:t.provide({dependencies:[r,u],handler:new a.FileScannerComputeHandler(new o.FileAssetsComputeHandlerController(d,e),new s.JsonManipulator,d,(0,a.createPathPredicate)(d,p.getProjectPath(),f),u),resourceConstructor:c.FileAssetsResource})}}))},24412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileAssetsComputeHandlerController=void 0,t.FileAssetsComputeHandlerController=class{constructor(e,t){this.fs=e,this.taggers=t}predicate(e){return this.getApplicableTaggers(e).length>0}getEmptyValue(){return{}}onFilesAdded(e,t){const r=[],i={...e};for(const e of t)i[e]=this.getTags(e);return r.push({kind:"replace",path:[],value:i}),{changes:r}}onRemoved(e,t){return Object.keys(e).filter((e=>e===t||e.startsWith(t+this.fs.sep))).map((e=>({kind:"remove",path:[e]})))}getApplicableTaggers(e){return[...this.taggers].filter((t=>t.isApplicableToFile(e)))}getTags(e){return[...new Set(this.getApplicableTaggers(e).flatMap((e=>e.tags)))]}}},78976:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileAssetsResource=void 0;const i=r(60814);class s extends i.JSONResource{getFilesWithTag(e,t=this.getLatest()){return Object.entries(t).filter((([,t])=>t.includes(e))).map((([e])=>e))}}t.FileAssetsResource=s},27176:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(5163).__exportStar(r(78976),t)},43934:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const i=r(5163);i.__exportStar(r(31434),t);var s=r(31434);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.__importDefault(s).default}})},98180:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.directoryManipulator=t.directoryReducer=t.DirectoryChangeKind=void 0,function(e){e.FULL="full",e.ADD="add",e.REMOVE="remove"}(r=t.DirectoryChangeKind||(t.DirectoryChangeKind={})),t.directoryReducer=(e,t)=>{switch(t.kind){case r.FULL:return{value:t.value,invertingChanges:[{kind:r.FULL,value:e}]};case r.ADD:return{value:[...e,t.node],invertingChanges:[{kind:r.FULL,value:e}]};case r.REMOVE:return{value:e.filter((e=>e.name!==t.name)),invertingChanges:[{kind:r.FULL,value:e}]};default:return{value:e,invertingChanges:[{kind:r.FULL,value:e}]}}},t.directoryManipulator={reducer:t.directoryReducer}},34232:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultFileNamingConvention=void 0;const i=r(91570);t.defaultFileNamingConvention=i.NamingConvention.KebabCase},61276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileScannerComputeHandler=t.getDirectoryEntities=t.traverseFs=void 0;const i=r(93849),s=r(98180);t.traverseFs=function e({directoryPath:t,fs:r,filterFile:s=i.returnsTrue,filterDirectory:n=i.returnsTrue,directories:a=[],files:o=[]}){const{readdirSync:c}=r;a.push({path:t,name:r.basename(t)});for(const i of c(t,{withFileTypes:!0})){const c=i.name,l=r.join(t,c);i.isDirectory()&&n(l,c)?e({directoryPath:l,fs:r,filterFile:s,filterDirectory:n,directories:a,files:o}):i.isFile()&&s(l,c)&&o.push({path:l,name:c})}return{directories:a,files:o}},t.getDirectoryEntities=function({directoryPath:e,fs:t}){const{readdirSync:r}=t,i={directories:[],files:[]};for(const s of r(e,{withFileTypes:!0})){const r=s.name,n=t.join(e,r);s.isDirectory()?i.directories.push({path:n,name:r}):s.isFile()&&i.files.push({path:n,name:r})}return i},t.FileScannerComputeHandler=class{constructor(e,t,r,i,s){this.controller=e,this.manipulator=t,this.fs=r,this.pathPredicate=i,this.directoryManager=s}compute(e){let t=this.controller.getEmptyValue();const{changes:r,dependencies:i}=this.addDirectory(e,t);for(const e of r)t=this.manipulator.reducer(t,e).value;return{value:t,dependencies:i,status:{valid:!0}}}recompute(e,t,r,i){const s=e.getLatest(),n=[];let a=new Set(i);for(const e of r){if(!e.isValid())continue;const r=e.getType(),{changes:i,dependencies:o}=this.getDirectoryRelatedUpdates(e,t[r][e.getSerializedId()],s,a);n.push(...i),a=o}const o=Array.from(i).filter((e=>!e.isValid()));return{dependencies:new Set([...a].filter((e=>!o.includes(e)))),changes:n,status:{valid:!0}}}addDirectory(e,t){const r=new Set,{files:i,directoryResources:s}=this.addDirRecurse(e),n=[],a=this.controller.onFilesAdded(t,i.map((({path:e})=>e)));return s.forEach((e=>r.add(e))),n.push(...a.changes),{changes:n,dependencies:r}}addDirRecurse(e,t=[],r=[],i=[]){const s=this.directoryManager.get(e);i.push(s);const n=s.getLatest();for(const s of n){const n={name:s.name,path:this.fs.join(e,s.name)};this.pathPredicate(n.path)&&(s.stats.isDirectory?(t.push(n),this.addDirRecurse(n.path,t,r,i)):s.stats.isFile&&this.controller.predicate(n.path)&&r.push(n))}return{files:r,directories:t,directoryResources:i}}getDirectoryRelatedUpdates(e,t,r,i){if(t.isDisposed())return{changes:[],dependencies:i};const n=[],a=new Set(i),o=e.getChangesFromVersion(t),c=e.getId();return o.forEach((e=>{if(e.kind===s.DirectoryChangeKind.ADD){const t=this.fs.join(c,e.node.name);if(e.node.stats.isDirectory){if(this.pathPredicate(t)){const{changes:e,dependencies:i}=this.addDirectory(t,r);for(const e of i)a.add(e);n.push(...e)}}else if(this.pathPredicate(t)&&this.controller.predicate(t)){const{changes:e}=this.controller.onFilesAdded(r,[t]);n.push(...e)}}else if(e.kind===s.DirectoryChangeKind.REMOVE){const t=this.fs.join(c,e.name);n.push(...this.controller.onRemoved(r,t))}})),{changes:n,dependencies:a}}}},33506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removePrefixPath=t.createPathPredicate=t.directoryDeepChildren=t.getPathsOfFilePath=t.getTreeNodePath=void 0;const i=r(71876),s=r(73654),n=r(91570);function a(e,t){return e.split(t).filter((e=>!!e))}function o(){return!0}t.getTreeNodePath=a,t.getPathsOfFilePath=function(e,t){var r;const i=e?a(e,t):[],s=[];for(let e=0;e<i.length;e++)s.push((null!==(r=s[e-1])&&void 0!==r?r:"")+t+i[e]);return s},t.directoryDeepChildren=async function*e(t,r,i=o,s=r){for(const n of await t.promises.readdir(r,{withFileTypes:!0})){const a=n.name,o=t.join(r,a),c=t.relative(s,o);if(n.isFile()){const e={type:"file",path:o,name:a,relativePath:c};i(e)&&(yield e)}else if(n.isDirectory()){const r={type:"directory",path:o,name:a,relativePath:c};i(r)&&(yield r,yield*e(t,o,i,s))}}},t.createPathPredicate=function(e,t,r){const s=r.map((e=>(0,i.makeRe)(e)));return r=>{const i=e.relative(t,r);return!s.some((e=>e.test(i)))}},t.removePrefixPath=(e,t)=>e?(0,n.replaceWinSlashes)(s.win32.relative(e,t)):(0,n.replaceWinSlashes)(t)},18012:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(5163);i.__exportStar(r(78204),t),i.__exportStar(r(98180),t),i.__exportStar(r(33506),t),i.__exportStar(r(98073),t),i.__exportStar(r(61276),t),i.__exportStar(r(34232),t)},98073:(e,t)=>{"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.NodeType=t.FsEventType=void 0,(i=t.FsEventType||(t.FsEventType={}))[i.CREATE=0]="CREATE",i[i.LOAD=1]="LOAD",i[i.UPDATE=2]="UPDATE",i[i.DELETE=3]="DELETE",(r=t.NodeType||(t.NodeType={}))[r.directory=0]="directory",r[r.file=1]="file",r[r.virtual=2]="virtual",r[r.none=3]="none"},2206:(e,t,r)=>{e.exports=r(43934)},69144:(e,t,r)=>{e.exports=r(18012)},60814:(e,t,r)=>{e.exports=r(73858)}}]);